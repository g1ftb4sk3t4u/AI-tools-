import React, { useState } from 'react';
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle, AlertDialogDescription } from "@/components/ui/alert-dialog";

const NetworkDashboard = () => {
  const [hostInput, setHostInput] = useState('');
  const [selectedVendor, setSelectedVendor] = useState(null);
  const [activeSection, setActiveSection] = useState('main');
  const [results, setResults] = useState('');
  const [showResults, setShowResults] = useState(false);

  // Network Tools Functions
  const runNetworkTool = async (tool) => {
    if (!hostInput) {
      setResults('Please enter an IP address or hostname first.');
      return;
    }

    setResults(`Running ${tool} on ${hostInput}...\n`);
    
    try {
      switch(tool) {
        case 'ping':
          // Simulate ping with multiple responses
          let pingResults = '';
          for (let i = 1; i <= 4; i++) {
            await new Promise(resolve => setTimeout(resolve, 500)); // Simulate network delay
            const time = Math.random() * 20 + 10; // Random time between 10-30ms
            pingResults += `64 bytes from ${hostInput}: icmp_seq=${i} ttl=64 time=${time.toFixed(2)} ms\n`;
            setResults(prevResults => prevResults + pingResults);
          }
          const avgTime = (Math.random() * 20 + 10).toFixed(2);
          setResults(prevResults => prevResults + `\n--- ${hostInput} ping statistics ---\n` +
            `4 packets transmitted, 4 received, 0% packet loss, time 3005ms\n` +
            `rtt min/avg/max/mdev = 10.2/${avgTime}/28.5/4.2 ms\n`);
          break;

        case 'nslookup':
          setResults(prevResults => prevResults + `Server:\t192.168.1.1\n` +
            `Address:\t192.168.1.1#53\n\n` +
            `Non-authoritative answer:\n` +
            `Name:\t${hostInput}\n` +
            `Address: ${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}\n`);
          break;

        case 'traceroute':
          let hops = Math.floor(Math.random() * 8) + 4; // 4-12 hops
          let currentIP = '10.0.0.1';
          for (let i = 1; i <= hops; i++) {
            await new Promise(resolve => setTimeout(resolve, 300));
            const time = Math.random() * 20 + 10;
            currentIP = `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
            setResults(prevResults => prevResults + 
              `${i}  router-${i}.isp.net (${currentIP})  ${time.toFixed(2)} ms\n`);
          }
          break;

        case 'whois':
          setResults(prevResults => prevResults + 
            `Domain Name: ${hostInput}\n` +
            `Registry Domain ID: D123456789-EXAMPLE\n` +
            `Registrar WHOIS Server: whois.example.com\n` +
            `Updated Date: 2024-02-22T15:22:33Z\n` +
            `Creation Date: 2020-01-15T10:11:12Z\n` +
            `Registry Expiry Date: 2025-01-15T10:11:12Z\n`);
          break;

        default:
          setResults(prevResults => prevResults + `Command ${tool} not implemented yet.\n`);
      }
    } catch (error) {
      setResults(prevResults => prevResults + `Error executing ${tool}: ${error.message}\n`);
    }
  };

  // Vendor-specific commands
  const vendorCommands = {
    Mikrotik: [
      { 
        name: 'Interface Status', 
        command: '/interface print',
        description: 'Shows all interfaces and their status'
      },
      { 
        name: 'OSPF Neighbors', 
        command: '/routing ospf neighbor print',
        description: 'Displays OSPF neighbor information'
      },
      { 
        name: 'BGP Status', 
        command: '/routing bgp peer print',
        description: 'Shows BGP peer status'
      },
      { 
        name: 'Resource Usage', 
        command: '/system resource print',
        description: 'Shows CPU, memory, and disk usage'
      }
    ],
    Cisco: [
      { 
        name: 'Interface Status', 
        command: 'show ip interface brief',
        description: 'Quick interface status overview'
      },
      { 
        name: 'BGP Summary', 
        command: 'show ip bgp summary',
        description: 'BGP neighbor status and routes'
      },
      { 
        name: 'CDP Neighbors', 
        command: 'show cdp neighbors detail',
        description: 'Detailed neighbor information'
      }
    ],
    Juniper: [
      { 
        name: 'Interface Status', 
        command: 'show interfaces terse',
        description: 'Concise interface status'
      },
      { 
        name: 'BGP Summary', 
        command: 'show bgp summary',
        description: 'BGP session overview'
      }
    ]
  };

  // RF Equipment Commands
  const rfCommands = {
    Cambium: [
      {
        name: 'Link Status',
        command: 'show wireless link-status',
        description: 'Shows current link status and quality'
      },
      {
        name: 'Radio Stats',
        command: 'show radio',
        description: 'Displays radio statistics and parameters'
      }
    ],
    Ubiquiti: [
      {
        name: 'Show Stations',
        command: 'mca-status',
        description: 'Shows connected stations and signal levels'
      },
      {
        name: 'RF Environment',
        command: 'spectrum-scan',
        description: 'Show RF spectrum analysis'
      }
    ]
  };

  // Results Dialog
  const ResultsDialog = () => (
    <AlertDialog open={showResults} onOpenChange={setShowResults}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>Command Results</AlertDialogTitle>
          <AlertDialogDescription>
            <pre className="bg-slate-900 p-4 rounded text-green-300 overflow-auto max-h-96">
              {results}
            </pre>
          </AlertDialogDescription>
        </AlertDialogHeader>
      </AlertDialogContent>
    </AlertDialog>
  );

  // Vendor-specific page
  const VendorPage = ({ vendor }) => {
    const commands = vendorCommands[vendor] || rfCommands[vendor] || [];
    
    return (
      <div className="space-y-4">
        <Button 
          onClick={() => setActiveSection('main')}
          className="mb-4 bg-green-500 hover:bg-green-600 text-black font-bold"
        >
          Back to Dashboard
        </Button>
        <Card className="border-2 border-green-500 bg-slate-900">
          <CardHeader>
            <CardTitle className="text-green-400">{vendor} Commands</CardTitle>
          </CardHeader>
          <CardContent className="grid grid-cols-2 gap-4">
            {commands.map((cmd, index) => (
              <div key={index} className="p-4 border-2 border-green-500 rounded bg-slate-800">
                <h3 className="font-medium mb-2 text-green-400">{cmd.name}</h3>
                <p className="text-sm text-green-300 mb-2">{cmd.description}</p>
                <code className="block bg-slate-900 p-2 rounded text-green-300">{cmd.command}</code>
                <Button 
                  className="mt-2 bg-green-500 hover:bg-green-600 text-black font-bold"
                  onClick={() => {
                    setResults(`Running command: ${cmd.command}\n`);
                    setShowResults(true);
                  }}
                >
                  Execute
                </Button>
              </div>
            ))}
          </CardContent>
        </Card>
      </div>
    );
  };

  const MainDashboard = () => (
    <div className="grid grid-cols-2 gap-4">
      {/* Network Tools Section */}
      <Card className="border-2 border-green-500 bg-slate-900">
        <CardHeader>
          <CardTitle className="text-green-400">Network Tools</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <Input
            placeholder="Enter IP or Hostname"
            value={hostInput}
            onChange={(e) => setHostInput(e.target.value)}
            className="bg-slate-800 text-green-300 border-green-500 focus:outline-none focus:ring-2 focus:ring-green-500"
            autoFocus
          />
          <div className="grid grid-cols-2 gap-2">
            {[
              'NSLookup',
              'Ping',
              'Traceroute',
              'MTR',
              'Dig',
              'Whois',
              'Curl',
              'Port Scan'
            ].map((tool) => (
              <Button 
                key={tool}
                onClick={() => runNetworkTool(tool.toLowerCase())}
                className="bg-green-500 hover:bg-green-600 text-black font-bold"
              >
                {tool}
              </Button>
            ))}
          </div>
        </CardContent>
      </Card>

      {/* Routers Section */}
      <Card className="border-2 border-blue-500 bg-slate-900">
        <CardHeader>
          <CardTitle className="text-blue-400">Routers</CardTitle>
        </CardHeader>
        <CardContent className="grid grid-cols-2 gap-2">
          {['Mikrotik', 'Nokia', 'Juniper', 'Cisco'].map((vendor) => (
            <Button
              key={vendor}
              onClick={() => {
                setSelectedVendor(vendor);
                setActiveSection('vendor');
              }}
              className="bg-blue-500 hover:bg-blue-600 text-black font-bold"
            >
              {vendor}
            </Button>
          ))}
        </CardContent>
      </Card>

      {/* RF Section */}
      <Card className="border-2 border-purple-500 bg-slate-900">
        <CardHeader>
          <CardTitle className="text-purple-400">RF Equipment</CardTitle>
        </CardHeader>
        <CardContent className="grid grid-cols-2 gap-2">
          {['Cambium', 'Aviat', 'Tachyon', 'Ubiquiti', 'Siklu'].map((vendor) => (
            <Button
              key={vendor}
              onClick={() => {
                setSelectedVendor(vendor);
                setActiveSection('vendor');
              }}
              className="bg-purple-500 hover:bg-purple-600 text-black font-bold"
            >
              {vendor}
            </Button>
          ))}
        </CardContent>
      </Card>

      {/* Misc Tools Section */}
      <Card className="border-2 border-cyan-500 bg-slate-900">
        <CardHeader>
          <CardTitle className="text-cyan-400">Misc Tools</CardTitle>
        </CardHeader>
        <CardContent className="grid grid-cols-2 gap-2">
          {[
            'Launch Wireshark',
            'Network Scanner',
            'Config Backup',
            'Log Analyzer'
          ].map((tool) => (
            <Button
              key={tool}
              onClick={() => console.log(`Opening ${tool}`)}
              className="bg-cyan-500 hover:bg-cyan-600 text-black font-bold"
            >
              {tool}
            </Button>
          ))}
        </CardContent>
      </Card>
    </div>
  );

  // Results display component
  const ResultsDisplay = () => (
    <Card className="mt-4 border-2 border-yellow-500 bg-slate-900">
      <CardHeader>
        <CardTitle className="text-yellow-400">Command Output</CardTitle>
      </CardHeader>
      <CardContent>
        <pre className="bg-black p-4 rounded text-green-300 font-mono text-sm overflow-auto max-h-48">
          {results || 'No command output yet. Enter an IP/hostname and run a command.'}
        </pre>
      </CardContent>
    </Card>
  );

  return (
    <div className="p-4 max-w-6xl mx-auto min-h-screen bg-gradient-to-b from-slate-950 to-black">
      {activeSection === 'main' ? (
        <>
          <MainDashboard />
          <ResultsDisplay />
        </>
      ) : (
        <VendorPage vendor={selectedVendor} />
      )}
    </div>
  );
};

export default NetworkDashboard;
